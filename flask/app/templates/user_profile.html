{% extends "layout.html" %}

{% block title %}{{ profile_user[1] }}{% endblock %}

{% block content %}
<div class="container py-3">

  {# profile_user: (id, username, is_blocked) #}
  <div class="d-flex justify-content-between align-items-start mb-3">
    <div>
      <h3 class="mb-0">{{ profile_user[1] }}</h3>
      <div class="text-muted small">User profile</div>
    </div>

    {# can_ban: bool (admin / mod with permission) #}
    {# ignoriraj error, nije zapravo #}
    {% if can_ban and session.get("user_id") and session.get("user_id") != profile_user[0] %}
      <form method="post"
            action="{{ url_for('admin.toggle_user_status', user_id=profile_user[0]) }}"
            onsubmit="return confirm('{{ 'Unban this user?' if profile_user[2] else 'Ban this user?' }}');">
        <input type="hidden" name="next" value="{{ request.full_path }}">
        <button type="submit"
                class="btn btn-sm {{ 'btn-outline-secondary' if profile_user[2] else 'btn-outline-danger' }}">
          {% if profile_user[2] %}
            <i class="bi bi-unlock"></i> Unban
          {% else %}
            <i class="bi bi-slash-circle"></i> Ban
          {% endif %}
        </button>
      </form>
    {% endif %}
  </div>

  {% if profile_user[2] %}
    <div class="alert alert-danger d-flex align-items-center gap-2">
      <i class="bi bi-exclamation-triangle"></i>
      <div>
        <strong>This user is banned.</strong>
        <div class="small">Only moderators/admins can view this profile.</div>
      </div>
    </div>
  {% endif %}

  <hr class="my-3">

  {# Reuse the feed renderer (expects posts, keywords_by_post, vote_by_post) #}
  {% include "_feed.html" %}

</div>
{% endblock %}
