{# templates/_feed.html #}

<div class="d-flex justify-content-between align-items-center mb-2">
  <h4 class="m-0">Latest posts</h4>

  {% if session.get("user_id") %}
    <a class="btn btn-primary btn-sm"
       href="{{ url_for('posts.new_post_get') }}">
      New post
    </a>
  {% endif %}
</div>

<div class="row g-3">
  {% for p in posts %}
    {# p: 0=id,1=title,2=created_at,3=username,4=media_type,5=file_path #}
    <div class="col-md-6">
      <a class="text-decoration-none text-dark"
         href="{{ url_for('posts.view_post', post_id=p[0]) }}">

        <div class="card h-100">

          {% if p[5] %}
            {% if p[4] == 'video' %}
              <video class="card-img-top" controls preload="metadata">
                <source src="{{ url_for('posts.media', filename=p[5]) }}">
              </video>
            {% else %}
              <img class="card-img-top"
                   src="{{ url_for('posts.media', filename=p[5]) }}"
                   alt="post media">
            {% endif %}
          {% endif %}

          <div class="card-body">
            <h5 class="card-title mb-1">{{ p[1] }}</h5>
            <div class="text-muted small">by {{ p[3] }}</div>
          </div>

        </div>
      </a>
    </div>
  {% else %}
    <div class="col-12">
      <div class="alert alert-light border">
        No posts yet.
        {% if session.get("user_id") %}
          <a href="{{ url_for('posts.new_post_get') }}">Create the first one</a>.
        {% endif %}
      </div>
    </div>
  {% endfor %}
</div>
