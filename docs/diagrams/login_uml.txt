@startuml
actor User
participant Browser
participant "Flask App" as App
database DB

User -> Browser: Submit login form\n(username, password, remember_me)
Browser -> App: POST /login

App -> App: Validate username\n(pattern or email_pattern)

alt Invalid username format
    App -> Browser: "Invalid username or password"
end

App -> DB: request user information
DB --> App: user record or None

alt User not found
    App -> Browser : "Invalid username or password"
end

App -> App : Check password (bcrypt)

alt Account not activated
    App -> Browser: "Please activate your account first."
end

App -> App: session.clear()
App -> App: store user_id, username

alt remember_me checked
    App -> App: session.permanent = True
else
    App -> App: session.permanent = False
end

App -> Browser: Login successful


@enduml